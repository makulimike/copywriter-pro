{% extends "base.html" %}

{% block title %}{{ campaign.name }} - Copywriter Pro{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h1>{{ campaign.name }}</h1>
        <p style="color: #7f8c8d;">Created: {{ campaign.created_at[:10] }}</p>
    </div>
    <div>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">â† Back</a>
    </div>
</div>

<!-- Stats Overview -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    <div class="card" style="text-align: center;">
        <div style="font-size: 2rem; font-weight: bold; color: #3498db;">{{ stats.total_leads }}</div>
        <div style="color: #7f8c8d;">Total Leads</div>
    </div>
    <div class="card" style="text-align: center;">
        <div style="font-size: 2rem; font-weight: bold; color: #27ae60;">{{ stats.total_sent }}</div>
        <div style="color: #7f8c8d;">Messages Sent</div>
    </div>
    <div class="card" style="text-align: center;">
        <div style="font-size: 2rem; font-weight: bold; color: #e67e22;">{{ stats.hot_leads }}</div>
        <div style="color: #7f8c8d;">Hot Leads</div>
    </div>
    <div class="card" style="text-align: center;">
        <div style="font-size: 2rem; font-weight: bold; color: #f39c12;">{{ stats.avg_rating }}</div>
        <div style="color: #7f8c8d;">Avg Rating</div>
    </div>
</div>

<!-- Channel Availability -->
<div class="card" style="margin-bottom: 2rem;">
    <h2>ğŸ“ Contact Availability</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; font-weight: bold;">{{ stats.contact_availability.email }}</div>
            <div style="color: #7f8c8d;">ğŸ“§ Email</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; font-weight: bold;">{{ stats.contact_availability.phone }}</div>
            <div style="color: #7f8c8d;">ğŸ“± WhatsApp</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; font-weight: bold;">{{ stats.contact_availability.facebook }}</div>
            <div style="color: #7f8c8d;">ğŸ‘¥ Facebook</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; font-weight: bold;">{{ stats.contact_availability.website }}</div>
            <div style="color: #7f8c8d;">ğŸŒ Website</div>
        </div>
    </div>
</div>

<!-- Actions -->
<div class="card" style="margin-bottom: 2rem;">
    <h2>âš¡ Actions</h2>
    
    <!-- Discovery -->
    <div style="margin-bottom: 2rem;">
        <h3>ğŸ” Find Leads</h3>
        <form method="POST" action="{{ url_for('discover_businesses_route', campaign_id=campaign.campaign_id) }}" style="display: inline;">
            <button type="submit" class="btn btn-primary">Find Businesses (Google Places)</button>
        </form>
        <form method="POST" action="{{ url_for('import_leads', campaign_id=campaign.campaign_id) }}" enctype="multipart/form-data" style="display: inline; margin-left: 1rem;">
            <input type="file" name="leads_file" accept=".csv" required style="display: none;" id="csv-file">
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('csv-file').click();">ğŸ“ Import CSV</button>
            <button type="submit" style="display: none;" id="submit-csv">Submit</button>
        </form>
    </div>
    
    <!-- Multi-channel Outreach -->
    <div>
        <h3>ğŸ“¢ Send Messages</h3>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            {% if 'email' in campaign.channels_enabled %}
            <form method="POST" action="{{ url_for('send_messages', campaign_id=campaign.campaign_id) }}" style="display: inline;">
                <input type="hidden" name="channel" value="email">
                <button type="submit" class="btn btn-success" onclick="return confirm('Send emails to {{ stats.contact_availability.email }} leads?')">
                    ğŸ“§ Send Emails
                </button>
            </form>
            {% endif %}
            
            {% if 'whatsapp' in campaign.channels_enabled %}
            <form method="POST" action="{{ url_for('send_messages', campaign_id=campaign.campaign_id) }}" style="display: inline;">
                <input type="hidden" name="channel" value="whatsapp">
                <button type="submit" class="btn btn-success" onclick="return confirm('Send WhatsApp messages to {{ stats.contact_availability.phone }} leads?')">
                    ğŸ“± Send WhatsApp
                </button>
            </form>
            {% endif %}
            
            {% if 'facebook' in campaign.channels_enabled %}
            <form method="POST" action="{{ url_for('send_messages', campaign_id=campaign.campaign_id) }}" style="display: inline;">
                <input type="hidden" name="channel" value="facebook">
                <button type="submit" class="btn btn-success" onclick="return confirm('Send Facebook messages to {{ stats.contact_availability.facebook }} leads?')">
                    ğŸ‘¥ Send Facebook
                </button>
            </form>
            {% endif %}
        </div>
    </div>
</div>

<!-- Leads Table -->
<div class="card">
    <h2>ğŸ“‹ Leads ({{ leads|length }})</h2>
    
    {% if leads %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 0.75rem; text-align: left;">Name</th>
                    <th style="padding: 0.75rem; text-align: left;">Company</th>
                    <th style="padding: 0.75rem; text-align: left;">Industry</th>
                    <th style="padding: 0.75rem; text-align: left;">Location</th>
                    <th style="padding: 0.75rem; text-align: left;">Rating</th>
                    <th style="padding: 0.75rem; text-align: left;">Contact</th>
                    <th style="padding: 0.75rem; text-align: left;">Score</th>
                    <th style="padding: 0.75rem; text-align: left;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in leads %}
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.75rem;">{{ lead.name }}</td>
                    <td style="padding: 0.75rem;">{{ lead.company }}</td>
                    <td style="padding: 0.75rem;">{{ lead.industry }}</td>
                    <td style="padding: 0.75rem;">{{ lead.location }}</td>
                    <td style="padding: 0.75rem;">{{ lead.rating }}â­</td>
                    <td style="padding: 0.75rem;">
                        {% if lead.email %}ğŸ“§{% endif %}
                        {% if lead.phone %}ğŸ“±{% endif %}
                        {% if lead.facebook_url %}ğŸ‘¥{% endif %}
                    </td>
                    <td style="padding: 0.75rem;">
                        <span style="background: {% if lead.qualification_score >= 70 %}#27ae60{% elif lead.qualification_score >= 40 %}#f39c12{% else %}#e74c3c{% endif %}; 
                                     color: white; padding: 0.25rem 0.5rem; border-radius: 4px;">
                            {{ lead.qualification_score }}
                        </span>
                    </td>
                    <td style="padding: 0.75rem;">
                        <a href="{{ url_for('lead_detail', lead_id=lead.lead_id) }}" class="btn btn-primary" style="padding: 0.25rem 0.5rem;">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="color: #7f8c8d; text-align: center; padding: 3rem;">No leads yet. Click "Find Businesses" to start discovering.</p>
    {% endif %}
</div>

<script>
document.getElementById('csv-file').addEventListener('change', function() {
    if(this.files.length > 0) {
        document.getElementById('submit-csv').click();
    }
});
</script>
{% endblock %}